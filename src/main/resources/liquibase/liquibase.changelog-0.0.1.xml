<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">
    <changeSet id="init" author="kolchev">
        <sql>
            CREATE TABLE bp_types
            (
            bp_pk VARCHAR(255) NOT NULL PRIMARY KEY,
            bp_name VARCHAR(255) NOT NULL
            );

            CREATE TABLE file_rules
            (
            rule_pk BIGINT AUTO_INCREMENT PRIMARY KEY,
            file_ext VARCHAR(255) NOT NULL,
            file_is_image BIT NULL DEFAULT 0,
            file_size INT NOT NULL,
            bp_type_bp_pk VARCHAR(255) NOT NULL,
            CONSTRAINT fk_bp_types
            FOREIGN KEY (bp_type_bp_pk) REFERENCES bp_types (bp_pk)
            );

            CREATE INDEX fk_bp_types ON file_rules (bp_type_bp_pk);

            CREATE TABLE files
            (
            file_pk BIGINT AUTO_INCREMENT PRIMARY KEY,
            full_file_name VARCHAR(255) NOT NULL,
            file_desc VARCHAR(255) NOT NULL,
            file_md5sum VARCHAR(255) NULL,
            file_size INT NULL,
            file_is_open BIT NOT NULL,
            file_link VARCHAR(255) NOT NULL,
            file_on_server VARCHAR(255),
            file_last_change BIGINT NOT NULL,
            bpe_type_bp_pk VARCHAR(255) NOT NULL,
            CONSTRAINT fk_files_bp_types
            FOREIGN KEY (bpe_type_bp_pk) REFERENCES bp_types (bp_pk)
            );

            CREATE INDEX fk_files_bp_types ON files (bpe_type_bp_pk);

            CREATE TABLE files_url
            (
            url_pk BIGINT AUTO_INCREMENT PRIMARY KEY,
            tmp_url VARCHAR(255) NOT NULL,
            file_file_pk BIGINT NOT NULL,
            CONSTRAINT fk_url_files
            FOREIGN KEY (file_file_pk) REFERENCES files (file_pk)
            );

            CREATE INDEX fk_url_files ON files_url (file_file_pk);

        </sql>
    </changeSet>
</databaseChangeLog>