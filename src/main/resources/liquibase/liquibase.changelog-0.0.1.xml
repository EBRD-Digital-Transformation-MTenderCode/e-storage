<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">
    <changeSet id="init" author="kolchev">
        <sql>
            CREATE TABLE bp_types
            (
            bp_pk   VARCHAR(255) NOT NULL PRIMARY KEY,
            bp_name VARCHAR(255) NOT NULL
            );

            CREATE TABLE extensions
            (
            ext_pk   BIGINT AUTO_INCREMENT PRIMARY KEY,
            is_image BOOLEAN NULL DEFAULT FALSE,
            ext_name VARCHAR(255) NOT NULL
            );

            CREATE TABLE file_sizes
            (
            id               BIGINT AUTO_INCREMENT PRIMARY KEY,
            size             INT          NOT NULL,
            bp_type_bp_pk    VARCHAR(255) NOT NULL,
            extension_ext_pk BIGINT       NOT NULL,
            CONSTRAINT fk_bp_types
            FOREIGN KEY (bp_type_bp_pk) REFERENCES bp_types (bp_pk),
            CONSTRAINT fk_extensions
            FOREIGN KEY (extension_ext_pk) REFERENCES extensions (ext_pk)
            );
            CREATE INDEX fk_bp_types ON file_sizes (bp_type_bp_pk);
            CREATE INDEX fk_extensions ON file_sizes (extension_ext_pk);

            CREATE TABLE files
            (
            file_pk        BIGINT AUTO_INCREMENT PRIMARY KEY,
            file_desc      VARCHAR(255) NOT NULL,
            file_md5sum    VARCHAR(255) NULL,
            file_on_server VARCHAR(255) NOT NULL,
            file_size      VARCHAR(255) NULL,
            full_file_name VARCHAR(255) NOT NULL,
            last_change    DATETIME(6)  NOT NULL,
            visible_all    BIT          NOT NULL,
            bpe_type_bp_pk VARCHAR(255) NOT NULL,
            CONSTRAINT fk_files_bp_types
            FOREIGN KEY (bpe_type_bp_pk) REFERENCES bp_types (bp_pk)
            );
            CREATE INDEX fk_files_bp_types ON files (bpe_type_bp_pk);

            CREATE TABLE files_url
            (
            url_pk       BIGINT AUTO_INCREMENT PRIMARY KEY,
            tmp_url      VARCHAR(255) NOT NULL,
            file_file_pk BIGINT       NOT NULL,
            CONSTRAINT fk_url_files
            FOREIGN KEY (file_file_pk) REFERENCES files (file_pk)
            );

            CREATE INDEX fk_url_files ON files_url (file_file_pk);
        </sql>
    </changeSet>
</databaseChangeLog>